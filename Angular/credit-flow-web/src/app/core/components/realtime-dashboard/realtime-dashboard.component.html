<div class="dashboard-container">
  <!-- Header with Connection Status -->
  <div class="dashboard-header">
    <h1>Loan Management Dashboard</h1>
    <div class="connection-indicator" [class.connected]="signalRService.isConnected()">
      <span class="dot"></span>
      {{ signalRService.isConnected() ? 'Real-time Connected' : 'Connecting...' }}
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üìã</div>
      <div class="stat-content">
        <div class="stat-label">Total Applications</div>
        <div class="stat-value">{{ loanApplications().length }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-label">Approved</div>
        <div class="stat-value">{{ approvedCount() }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <div class="stat-label">Pending Review</div>
        <div class="stat-value">{{ pendingCount() }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-label">Total Approved</div>
        <div class="stat-value">${{ totalApproved().toLocaleString() }}</div>
      </div>
    </div>
  </div>

  <!-- Loan Applications Table -->
  <div class="applications-section">
    <h2>Loan Applications</h2>
    
    @if (loanApplications().length === 0) {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <path d="M3 9h18"></path>
          <path d="M9 3v18"></path>
        </svg>
        <p>No loan applications yet</p>
      </div>
    } @else {
      <div class="applications-grid">
        @for (loan of loanApplications(); track loan.id) {
          <div class="loan-card" [class.loading]="loan.isLoading" [@slideUp]>
            <div class="loan-header">
              <div>
                <h3>{{ loan.title }}</h3>
                <p class="applicant">{{ loan.applicantName }}</p>
              </div>
              <div class="loan-status" [class]="'status-' + loan.status.toLowerCase()">
                {{ loan.status }}
              </div>
            </div>

            <div class="loan-amount">
              <span class="label">Loan Amount</span>
              <span class="amount">${{ loan.amount.toLocaleString() }}</span>
            </div>

            <div class="progress-section">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="loan.progress"></div>
              </div>
              <span class="progress-text">{{ loan.progress }}% Complete</span>
            </div>

            <div class="loan-actions">
              <button class="action-btn view-btn" (click)="viewDetails(loan)">
                View Details
              </button>
              @switch(loan.status) {
                @case(loanStatusText.Draft) {
                  <button class="action-btn submit-btn" (click)="submitApplication(loan)">
                    Submit
                  </button>
                }
                @case(loanStatusText.Submitted) {
                  <button class="action-btn approve-btn" (click)="approveApplication(loan)">
                    Approve
                  </button>
                  <button class="action-btn reject-btn" (click)="rejectApplication(loan)">
                    Reject
                  </button>
                }
              }
            </div>

            <div class="loan-footer">
              <span class="last-update">Updated: {{ formatTime(loan.lastUpdate) }}</span>
              @if (loan.isLoading) {
                <span class="loading-indicator">Processing...</span>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Recent Activity -->
  <div class="activity-section">
    <h2>Recent Activity</h2>
    @if (recentActivity().length === 0) {
      <div class="empty-state">
        <p>No recent activity</p>
      </div>
    } @else {
      <div class="activity-list">
        @for (activity of recentActivity(); track activity.timestamp) {
          <div class="activity-item" [class]="'activity-' + activity.type">
            <div class="activity-icon">{{ getActivityIcon(activity.type) }}</div>
            <div class="activity-details">
              <h4>{{ activity.title }}</h4>
              <p>{{ activity.message }}</p>
              <span class="activity-time">{{ formatTime(activity.timestamp) }}</span>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
